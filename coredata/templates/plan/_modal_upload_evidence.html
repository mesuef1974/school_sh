{% load static %}
<div class="modal-backdrop" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">

        <!-- Header -->
        <div class="modal-header branded-header">
            <div class="header-brand">
                <div class="header-icon-box">
                    <i class="fa-solid fa-cloud-arrow-up"></i>
                </div>
                <div class="header-titles">
                    <h3>رفع الدليل المطلوب</h3>
                </div>
            </div>
            <button type="button" class="close-btn" onclick="closeModal()" title="إغلاق">✕</button>
        </div>

        <!-- Form -->
        <form id="upload-evidence-form"
              hx-post="{% url 'plan_upload_evidence_save' item.id %}"
              hx-target="#row-{{ item.id }}"
              hx-swap="outerHTML"
              hx-encoding="multipart/form-data"
              class="modal-form">
            {% csrf_token %}

            <div class="modal-body">
                <!-- Item Info -->
                <div class="item-info-banner">
                    <span class="info-label">الإجراء:</span>
                    <span class="info-value">{{ item.procedure }}</span>
                </div>

                <div class="upload-grid">
                    <!-- File Input -->
                    <div class="input-group">
                        <label for="{{ form.file.id_for_label }}">{{ form.file.label }}</label>
                        {{ form.file }}
                        <div class="help-text"><i class="fa-solid fa-circle-info"></i> يدعم ملفات: PDF, JPG, PNG, DOCX</div>
                    </div>

                    <!-- Title -->
                    <div class="input-group">
                        <label for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
                        {{ form.title }}
                    </div>

                    <!-- Description -->
                    <div class="input-group">
                        <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
                        {{ form.description }}
                    </div>
                </div>

                <div class="alert-info-gold">
                    <i class="fa-solid fa-circle-info"></i>
                    سيتم حفظ هذا الملف تلقائياً في "مستودع الأدلة" وربطه بهذا البند للمراجعة.
                </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">إلغاء</button>
                <button type="submit" class="btn btn-primary gold-btn" id="upload-btn">
                    <span class="btn-text">بدء الرفع والحفظ</span>
                    <span id="save-btn-spinner" class="htmx-indicator spinner-border spinner-border-sm" role="status" aria-hidden="true" style="margin-left: 8px;"></span>
                </button>
            </div>
        </form>
    </div>
</div>

    <style>
    /* --- Variables --- */
    :root {
        --maroon: #3d071c;
        --maroon-deep: #5b0e2d;
        --maroon-light: #7b1e2b;
        --gold-accent: #c7a43c;
        --gray-bg: #f8fafc;
        --gray-border: #e2e8f0;
        --text-dark: #0f172a;
        --text-muted: #64748b;
    }

    /* --- Layout --- */
    .modal-backdrop {
        position: fixed; inset: 0; z-index: 1100;
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(4px);
        display: flex; align-items: center; justify-content: center;
        animation: fadeIn 0.2s ease-out;
    }

    .modal-content {
        background: #fff;
        width: 90vw; max-width: 600px; /* Specialized for Upload */
        height: auto; max-height: 90vh;
        border-radius: 12px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        display: flex; flex-direction: column;
        overflow: hidden;
        animation: slideUp 0.3s ease-out;
    }

    /* --- Header --- */
    .modal-header.branded-header {
        padding: 0.8rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
    }

    .header-brand { display: flex; align-items: center; gap: 0.8rem; }
    .header-icon-box { color: var(--gold-accent); font-size: 1.2rem; }
    .header-titles h3 { margin: 0; font-family: 'Tajawal', sans-serif; font-weight: 700; font-size: 1.1rem; }

    .close-btn {
        background: none; border: none; color: white;
        font-size: 1.5rem; cursor: pointer; opacity: 0.8;
        line-height: 1; display: flex; align-items: center;
    }
    .close-btn:hover { opacity: 1; }

    /* --- Body --- */
    .modal-form { display: flex; flex-direction: column; flex: 1; overflow: hidden; }
    .modal-body {
        flex: 1; padding: 1.5rem;
        background: var(--gray-bg);
        display: flex; flex-direction: column; gap: 1rem;
        overflow-y: auto;
    }

    /* --- Form Elements --- */
    .input-group { display: flex; flex-direction: column; gap: 0.4rem; }
    .input-group label {
        font-weight: 700; font-size: 0.85rem; color: var(--text-dark);
        font-family: 'Tajawal', sans-serif;
    }

    .form-control {
        width: 100%; padding: 0.6rem 0.8rem;
        border: 1px solid var(--gray-border); border-radius: 8px;
        font-family: 'Amiri', serif; font-size: 1rem;
        background: #fff; transition: border-color 0.2s;
    }
    .form-control:focus { border-color: var(--maroon-light); outline: none; box-shadow: 0 0 0 3px rgba(123, 30, 43, 0.1); }
    .gold-border { border-color: var(--gold-accent) !important; }

    .item-info-banner {
        background: #fff;
        border-right: 4px solid var(--maroon);
        padding: 12px 15px;
        border-radius: 6px;
        margin-bottom: 5px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.02);
    }
    .info-label { font-weight: 800; color: var(--maroon); margin-left: 10px; font-size: 0.8rem; }
    .info-value { font-family: 'Amiri', serif; font-size: 1rem; color: var(--text-dark); }

    .help-text { font-size: 0.75rem; color: var(--text-muted); margin-top: 2px; }

    .alert-info-gold {
        padding: 12px;
        background: #fffbeb;
        border: 1px solid #fde68a;
        color: #92400e;
        border-radius: 8px;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }

    /* --- Footer --- */
    .modal-footer {
        padding: 1rem 1.5rem; background: white;
        border-top: 1px solid var(--gray-border);
        display: flex; justify-content: flex-end; gap: 0.8rem;
        flex-shrink: 0;
    }

    .btn {
        padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 700;
        font-family: 'Tajawal', sans-serif; cursor: pointer; border: none; font-size: 0.95rem;
        transition: all 0.2s;
    }
    .btn-secondary { background: #f1f5f9; color: var(--text-dark); }
    .btn-secondary:hover { background: #e2e8f0; }
    
    .gold-btn { background: var(--gold-accent) !important; color: #fff !important; }
    .gold-btn:hover { background: #a18225 !important; transform: translateY(-1px); }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
</style>